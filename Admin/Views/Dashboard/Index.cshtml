@model MS2Api.Model.StatistiquesData


@{
    ViewData["Title"] = "Dashboard";
}

@section Styles {
}


    <div class="container-fluid">
        <div class="row">
        <div class="col-xl-6">
            <div class="card">
                <div class="card-body pb-0">
                    <div class="d-flex align-items-start">
                        <div class="flex-grow-1">
                            <h5 class="card-title mb-4">Bénéficiaires par Nationalité</h5>
                        </div>
                        <div class="flex-shrink-0">
                           
                        </div>
                    </div>

                    <div>
                        <div id="nationality-chart"></div>
                    </div>
                </div>
            </div>
        </div>

            <div class="col-xl-6">
                <div class="row">
                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-body">
                            <div>
                                <div class="d-flex align-items-center">
                                    <div class="avatar">
                                        <div class="avatar-title rounded bg-primary-subtle">
                                            <i class="bx bx-male-sign font-size-24 mb-0 text-primary"></i>
                                        </div>
                                    </div>

                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-0 font-size-15">Nombre d'Hommes</h6>
                                    </div>

                                    <div class="flex-shrink-0">
                                        <div class="dropdown">
                                            <a class="dropdown-toggle" href="#"
                                               data-bs-toggle="dropdown" aria-haspopup="true"
                                               aria-expanded="false">
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="mt-4 pt-1 mb-0 font-size-22">@Model.NombreHommes <span class="text-success fw-medium font-size-13 align-middle"> </h4>
                                   
                                </div>
                            </div>

                            </div>
                        </div>
                    </div>

                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-body">
                            <div>
                                <div class="d-flex align-items-center">
                                    <div class="avatar">
                                        <div class="avatar-title rounded bg-primary-subtle">
                                            <i class="bx bx-female font-size-24 mb-0 text-primary"></i>
                                        </div>
                                    </div>

                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-0 font-size-15">Nombre de Femmes</h6>
                                    </div>

                                    <div class="flex-shrink-0">
                                        <div class="dropdown">
                                            <a class="dropdown-toggle" href="#"
                                               data-bs-toggle="dropdown" aria-haspopup="true"
                                               aria-expanded="false">
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="mt-4 pt-1 mb-0 font-size-22">@Model.NombreFemmes <span class="text-success fw-medium font-size-13 align-middle"> </h4>
                                    <div class="d-flex mt-1 align-items-end overflow-hidden">
                                       
                                    </div>
                                </div>
                            </div>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-body">
                            <div>
                                <div class="d-flex align-items-center">
                                    <div class="avatar">
                                        <div class="avatar-title rounded bg-primary-subtle">
                                            <i class="bx bx-user font-size-24 mb-0 text-primary"></i>
                                        </div>
                                    </div>

                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-0 font-size-15">Nombre de Bénéficiaires</h6>
                                    </div>

                                    <div class="flex-shrink-0">
                                        <div class="dropdown">
                                            <a class="dropdown-toggle" href="#"
                                               data-bs-toggle="dropdown" aria-haspopup="true"
                                               aria-expanded="false">
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="mt-4 pt-1 mb-0 font-size-22">@Model.TotalBeneficiaires <span class="text-success fw-medium font-size-13 align-middle"></h4>
                                    <div class="d-flex mt-1 align-items-end overflow-hidden">
                                       
                                    </div>
                                </div>
                            </div>

                            </div>
                        </div>
                    </div>

                    <div class="col-xl-6">
                        <div class="card">
                            <div class="card-body">
                            <div>
                                <div class="d-flex align-items-center">
                                    <div class="avatar">
                                        <div class="avatar-title rounded bg-primary-subtle">
                                            <i class="fas fa-child"></i> <!-- Icône de mineur -->
                                        </div>
                                    </div>

                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-0 font-size-15">Nombre de Mineurs</h6>
                                    </div>

                                    <div class="flex-shrink-0">
                                        <div class="dropdown">
                                            <a class="dropdown-toggle" href="#"
                                               data-bs-toggle="dropdown" aria-haspopup="true"
                                               aria-expanded="false">
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h4 class="mt-4 pt-1 mb-0 font-size-22">@Model.NombreMineurs <span class="text-success fw-medium font-size-13 align-middle"></span></h4>
                                    <div class="d-flex mt-1 align-items-end overflow-hidden">
                                    </div>
                                </div>
                            </div>


                            </div>
                        </div>
                    </div>
                <div class="col-xl-7">
             
                </div>
                </div>
            </div>
        </div>
            <!-- end row -->

        <div class="row">
            <div class="col-xxl-8">
            @{
                int count = 0;
            }

            <div class="row">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-4">List of Beneficiaries</h5>
                        <div class="table-responsive" style="max-height: 200px; overflow-y: auto;">
                            <table class="table table-striped table-centered align-middle table-nowrap mb-0 table-check">
                                <thead>
                                    <tr>
                                        <th>Photo</th>
                                        <th>Nom</th>
                                        <th>Prenom</th>
                                        <th>Age</th>
                                        <th>Sexe</th>
                                        <th>Tele</th>
                                        <th>TeleUrgent</th>
                                        <th>Pays Origin</th>
                                        <th>Nationalite</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var beneficiary in Model.Beneficiaries.Take(2))
                                    {
                                        <tr>
                                            <td class="fw-semibold">
                                                @if (beneficiary.Sexe == "Homme")
                                                {
                                                    <img class="rounded-circle header-profile-user" src="~/assets/images/users/profile_homme.png" alt="Avatar d'en-tête">
                                                }
                                                else
                                                {
                                                    <img class="rounded-circle header-profile-user" src="~/assets/images/users/profile_femme.png" alt="Avatar d'en-tête">
                                                }
                                            </td>
                                            <td>@beneficiary.Nom</td>
                                            <td>@beneficiary.Prenom</td>
                                            <td>@beneficiary.Age</td>
                                            <td>@beneficiary.Sexe</td>
                                            <td>@beneficiary.Tele</td>
                                            <td>@beneficiary.TeleUrgent</td>
                                            <td>@beneficiary.PaysOrigin</td>
                                            <td>@beneficiary.Nationalite</td>
                                        </tr>
                                    }
                                    @foreach (var beneficiary in Model.Beneficiaries.Skip(2))
                                    {
                                        <tr>
                                            <td class="fw-semibold">
                                                @if (beneficiary.Sexe == "Homme")
                                                {
                                                    <img class="rounded-circle header-profile-user" src="~/assets/images/users/profile_homme.png" alt="Avatar d'en-tête">
                                                }
                                                else
                                                {
                                                    <img class="rounded-circle header-profile-user" src="~/assets/images/users/profile_femme.png" alt="Avatar d'en-tête">
                                                }
                                            </td>
                                            <td>@beneficiary.Nom</td>
                                            <td>@beneficiary.Prenom</td>
                                            <td>@beneficiary.Age</td>
                                            <td>@beneficiary.Sexe</td>
                                            <td>@beneficiary.Tele</td>
                                            <td>@beneficiary.TeleUrgent</td>
                                            <td>@beneficiary.PaysOrigin</td>
                                            <td>@beneficiary.Nationalite</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


            
            </div>

        <div class="col-xxl-4">
            
            <div class="card">
                <div class="card-body pb-0">
                    <div class="d-flex align-items-start">
                        <div class="flex-grow-1 overflow-hidden">
                            <h5 class="card-title mb-4 text-truncate">Nombre de bénéficiaires par ville</h5>
                        </div>
                        <div class="flex-shrink-0 ms-2">
                        </div>
                    </div>
                    <div id="beneficiaries-chart" class="apex-charts" dir="ltr"></div>
                </div>
            </div>
        </div>
        </div>  
    </div>


@section Scripts {
    <!-- apexcharts -->
    <script src="~/assets/libs/apexcharts/apexcharts.min.js"></script>
    <!-- Vector map-->
    <script src="~/assets/libs/jsvectormap/js/jsvectormap.min.js"></script>
    <script src="~/assets/libs/jsvectormap/maps/world-merc.js"></script>
    <script src="~/assets/js/pages/dashboard.init.js"></script>
    <script src="~/assets/libs/jquery/jquery-3.6.0.min.js"></script>
    <script src="~/assets/libs/chart.js/chart.umd.js"></script>
   
    <script>
        $(document).ready(function () {
            // Données du graphique pour Sexe
            var ctxGender = document.getElementById('genderChart').getContext('2d');
            new Chart(ctxGender, {
                type: 'pie',
                data: {
                    labels: ['Hommes', 'Femmes'],
                    datasets: [{
                        data: [@Model.NombreHommes, @Model.NombreFemmes],
                        backgroundColor: ['#4CAF50', '#FFC107']
                    }]
                },
                options: {
                    responsive: true
                }
            });

            // Données du graphique pour Âge
            var ctxAge = document.getElementById('ageChart').getContext('2d');
            new Chart(ctxAge, {
                type: 'bar',
                data: {
                    labels: ['Mineurs', 'Non-Mineurs'],
                    datasets: [{
                        data: [@Model.NombreMineurs, @Model.NombreNonMineurs],
                        backgroundColor: ['#FF5722', '#03A9F4']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>


   <script>
     document.addEventListener('DOMContentLoaded', function () {
         var colors = ["#1E90FF", "#4682B4", "#4169E1", "#5F9ED5", "#87CEEB"]; // Nuances de bleu

         var options = {
             series: [{
                 name: 'Nombre de Bénéficiaires',
                 data: @Html.Raw(Json.Serialize(Model.BeneficiariesPerNationality.Select(b => b.Value)))
                 }],
             chart: {
                 type: 'bar',
                 height: 350
             },
             plotOptions: {
                 bar: {
                     horizontal: false,
                     endingShape: 'rounded',
                     borderRadius: 5, // Ajoute un rayon de bordure arrondie aux barres
                     dataLabels: {
                         position: 'top' // Positionne les étiquettes de données en haut des barres
                     }
                 }
             },
             colors: colors, // Applique les couleurs définies
             dataLabels: {
                 enabled: true
             },
             xaxis: {
                 categories: @Html.Raw(Json.Serialize(Model.BeneficiariesPerNationality.Select(b => b.Key)))
                 },
             yaxis: {
                 title: {
                     text: 'Nombre de Bénéficiaires'
                 }
             },
             fill: {
                 opacity: 0.8
             },
             tooltip: {
                 y: {
                     formatter: function (val) {
                         return val + " bénéficiaires";
                     }
                 }
             }
         };

         var chart = new ApexCharts(document.querySelector("#nationality-chart"), options);
         chart.render();
     });
 </script>
              
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var options = {
                series: @Html.Raw(Json.Serialize(Model.BeneficiariesPerCity.Values)),
                chart: {
                    type: 'donut',
                    height: 400  // Ajuster la hauteur du graphique ici
                },
                labels: @Html.Raw(Json.Serialize(Model.BeneficiariesPerCity.Keys)),
                responsive: [{
                    breakpoint: 480,
                    options: {
                        chart: {
                            width: 300
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }]
            };

            var chart = new ApexCharts(document.querySelector("#beneficiaries-chart"), options);
            chart.render();
        });
    </script>

}


